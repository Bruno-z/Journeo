<div class="home">
  <!-- üé® Styles int√©gr√©s pour le nouveau Design "Pro" -->
  <style>
    /* Grille responsive : vise 5 colonnes sur grand √©cran, s'adapte sinon */
    .guides-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 2rem;
      padding: 0.5rem;
    }

    /* Carte "Poster" magnifique */
    .travel-card {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      aspect-ratio: 3/4; /* Format portrait √©l√©gant */
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      isolation: isolate;
    }

    /* Image de fond s√©par√©e pour l'effet de zoom ind√©pendant */
    .travel-card__bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
      z-index: -2;
    }

    /* Effet de survol : Agrandissement + Ombre port√©e */
    .travel-card:hover {
      transform: translateY(-8px); /* La carte monte seulement */
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.25), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }

    /* Au survol, l'image zoome doucement */
    .travel-card:hover .travel-card__bg {
      transform: scale(1.1);
    }

    /* Overlay d√©grad√© pour lisibilit√© */
    .travel-card__overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0) 100%);
      z-index: -1;
      transition: background 0.3s;
    }
    
    .travel-card:hover .travel-card__overlay {
      background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.7) 60%, rgba(0,0,0,0.1) 100%);
    }

    .travel-card__content {
      padding: 1.5rem;
      width: 100%;
    }

    /* Animation d'apparition des activit√©s */
    .travel-card__activities {
      display: grid;
      grid-template-rows: 0fr;
      opacity: 0;
      transition: grid-template-rows 0.4s ease, opacity 0.4s ease, margin-top 0.4s ease;
      margin-top: 0;
    }

    .travel-card:hover .travel-card__activities {
      grid-template-rows: 1fr;
      opacity: 1;
      margin-top: 1rem;
    }

    .activities-inner {
      overflow: hidden;
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: #cbd5e1;
      margin-bottom: 4px;
    }

    .activity-item::before { content: ''; display: block; width: 6px; height: 6px; border-radius: 50%; background-color: #38bdf8; }
  </style>

  

  <!-- ===== Guides ===== -->
  <section class="home__section" aria-labelledby="guides-heading">
    <div class="home__section-header">
      <div class="header-group">
        <h2 id="guides-heading" class="home__section-title home__section-title--accent">
          @if (auth.isAdmin()) { Guides R√©cents} @else { Mes voyages }
        </h2>

        <!-- Mini Stats (int√©gr√©es au header) -->
        <div class="mini-stats">
          <div class="mini-stat" title="Guides totaux">
            <div class="mini-stat__icon-box mini-stat__icon-box--guides">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>
            </div>
            <span class="mini-stat__value">@if (loading()) { ‚Äî } @else { {{ guideCount() }} }</span>
          </div>
          
          @if (auth.isAdmin()) {
            <div class="mini-stat" title="Utilisateurs">
              <div class="mini-stat__icon-box mini-stat__icon-box--users">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75"/></svg>
              </div>
              <span class="mini-stat__value">{{ userCount() }}</span>
            </div>
          }

          <div class="mini-stat" title="Activit√©s">
            <div class="mini-stat__icon-box mini-stat__icon-box--activities">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            </div>
            <span class="mini-stat__value">{{ totalActivities() }}</span>
          </div>
        </div>
      </div>

      <a routerLink="/dashboard/guides" class="home__see-all">
        Voir tous
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" aria-hidden="true">
          <path d="M5 12h14m-7-7l7 7-7 7"/>
        </svg>
      </a>
    </div>

    @if (loading()) {
      <div class="guides-grid">
        @for (i of [1,2,3,4]; track i) {
          <div class="travel-card travel-card--skeleton" aria-hidden="true"></div>
        }
      </div>
    } @else if (ratedGuides().length === 0) {
      <div class="empty-state">
        <div class="empty-state__icon" aria-hidden="true">üó∫Ô∏è</div>
        <p class="empty-state__title">Aucun guide disponible</p>
        @if (auth.isAdmin()) {
          <a routerLink="/dashboard/guides/new" class="btn btn--primary">Cr√©er votre premier guide</a>
        }
      </div>
    } @else {
      <div class="guides-grid" role="list">
        @for (guide of ratedGuides(); track guide.id) {
          <a
            routerLink="/dashboard/guides/{{ guide.id }}"
            class="travel-card"
            role="listitem"
            [attr.aria-label]="guide.titre"
          >
            <img [src]="coverFor(guide)" class="travel-card__bg" alt="" loading="lazy">
            <div class="travel-card__overlay"></div>
            <div class="travel-card__content">
              <div class="travel-card__chips">
                <span class="travel-chip">{{ saisonLabels[guide.saison] ?? guide.saison }}</span>
                <span class="travel-chip">{{ mobiliteLabels[guide.mobilite] ?? guide.mobilite }}</span>
              </div>
              <h3 class="travel-card__title">{{ guide.titre }}</h3>
              <p class="travel-card__meta">
                {{ guide.jours }} jour{{ guide.jours > 1 ? 's' : '' }}
                @if (guide.activities?.length) {
                  ¬∑ {{ guide.activities.length }} activit√©{{ guide.activities.length > 1 ? 's' : '' }}
                }
              </p>
              
              <!-- Liste des activit√©s (visible au survol) -->
              @if (guide.activities && guide.activities.length > 0) {
                <div class="travel-card__activities">
                  <div class="activities-inner">
                    @for (act of guide.activities.slice(0, 3); track $index) {
                      <div class="activity-item">{{ act.titre || 'Activit√©' }}</div>
                    }
                    @if (guide.activities.length > 3) {
                      <div class="activity-item" style="color: #94a3b8; font-style: italic;">+ {{ guide.activities.length - 3 }} autres...</div>
                    }
                  </div>
                </div>
              }
            </div>
          </a>
        }
      </div>
    }
  </section>

  <!-- ===== Activit√©s R√©centes (Nouveau pour combler le vide) ===== -->
  @if (latestActivities().length > 0) {
    <section class="home__section" style="margin-top: 2rem;">
      <div class="home__section-header">
        <h2 class="home__section-title home__section-title--accent">Activit√©s √† venir</h2>
      </div>
      
      <div style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));">
        @for (act of latestActivities(); track $index) {
          <a [routerLink]="['/dashboard/guides', act.guideId]" class="stat-card" style="text-decoration: none; color: inherit; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
            <div class="stat-card__icon" style="background: #e0f2fe; color: #0284c7;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
            <div style="overflow: hidden;">
              <div style="font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                {{ act.titre || 'Activit√© sans nom' }}
              </div>
              <div style="font-size: 0.875rem; color: #64748b;">
                Dans : {{ act.guideTitle }}
              </div>
            </div>
          </a>
        }
      </div>
    </section>
  }

</div>
