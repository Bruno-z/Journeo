<div class="form-page">

  <!-- Header -->
  <div class="form-page__header">
    <button type="button" class="form-back-btn" (click)="cancel()" aria-label="Annuler">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M19 12H5m0 0l7 7m-7-7l7-7"/>
      </svg>
    </button>
    <div>
      <h1 class="form-page__title">{{ isEdit() ? 'Modifier le guide' : 'Nouveau guide' }}</h1>
      <p class="form-page__sub">{{ isEdit() ? 'Mettre Ã  jour les informations du voyage' : 'CrÃ©ez un nouveau guide de voyage' }}</p>
    </div>
  </div>

  @if (error()) {
    <div class="alert alert--error" role="alert">{{ error() }}</div>
  }

  @if (loading()) {
    <div class="loading-container">
      <span class="spinner spinner--dark" aria-label="Chargement"></span>
      Chargementâ€¦
    </div>
  } @else {
    <div class="form-layout">

      <!-- LEFT: Form -->
      <div class="form-panel">

        <form [formGroup]="form" (ngSubmit)="submit()" novalidate class="guide-form">

          <!-- Titre -->
          <div class="form-section">
            <h2 class="form-section__title">
              <span class="form-section__num">1</span>
              Informations gÃ©nÃ©rales
            </h2>

            <div class="form-group">
              <label for="titre" class="form-label">
                Titre du voyage <span class="form-required" aria-hidden="true">*</span>
              </label>
              <input
                id="titre"
                type="text"
                formControlName="titre"
                class="form-input"
                [class.form-input--error]="form.get('titre')?.invalid && form.get('titre')?.touched"
                placeholder="Ex : Tour de Bretagne, Semaine Ã  Romeâ€¦"
                autocomplete="off"
              />
              @if (form.get('titre')?.invalid && form.get('titre')?.touched) {
                <span class="form-error" role="alert">Titre requis (min. 2 caractÃ¨res)</span>
              }
            </div>

            <div class="form-group">
              <label for="description" class="form-label">Description</label>
              <textarea
                id="description"
                formControlName="description"
                class="form-input form-textarea"
                rows="3"
                placeholder="DÃ©crivez l'ambiance, les temps forts, les conseils pratiquesâ€¦"
              ></textarea>
            </div>
          </div>

          <!-- DurÃ©e & ParamÃ¨tres -->
          <div class="form-section">
            <h2 class="form-section__title">
              <span class="form-section__num">2</span>
              ParamÃ¨tres du voyage
            </h2>

            <div class="form-grid-3">
              <div class="form-group">
                <label for="jours" class="form-label">
                  DurÃ©e <span class="form-required" aria-hidden="true">*</span>
                </label>
                <div class="form-input-with-unit">
                  <input
                    id="jours"
                    type="number"
                    formControlName="jours"
                    class="form-input"
                    [class.form-input--error]="form.get('jours')?.invalid && form.get('jours')?.touched"
                    min="1"
                  />
                  <span class="form-unit">jours</span>
                </div>
                @if (form.get('jours')?.invalid && form.get('jours')?.touched) {
                  <span class="form-error" role="alert">Minimum 1 jour</span>
                }
              </div>

              <div class="form-group">
                <label for="saison" class="form-label">Saison <span class="form-required" aria-hidden="true">*</span></label>
                <select id="saison" formControlName="saison" class="form-input form-select">
                  <option value="ETE">â˜€ï¸ Ã‰tÃ©</option>
                  <option value="PRINTEMPS">ğŸŒ¸ Printemps</option>
                  <option value="AUTOMNE">ğŸ‚ Automne</option>
                  <option value="HIVER">â„ï¸ Hiver</option>
                </select>
              </div>

              <div class="form-group">
                <label for="mobilite" class="form-label">MobilitÃ© <span class="form-required" aria-hidden="true">*</span></label>
                <select id="mobilite" formControlName="mobilite" class="form-input form-select">
                  <option value="A_PIED">ğŸš¶ Ã€ pied</option>
                  <option value="VOITURE">ğŸš— Voiture</option>
                  <option value="VELO">ğŸš´ VÃ©lo</option>
                  <option value="MOTO">ğŸï¸ Moto</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="pourQui" class="form-label">Public cible <span class="form-required" aria-hidden="true">*</span></label>
              <div class="form-radio-group" role="radiogroup">
                <label class="form-radio-card" [class.form-radio-card--active]="form.get('pourQui')?.value === 'FAMILLE'">
                  <input type="radio" formControlName="pourQui" value="FAMILLE" class="sr-only" />
                  <span class="form-radio-card__icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                  <span class="form-radio-card__label">Famille</span>
                </label>
                <label class="form-radio-card" [class.form-radio-card--active]="form.get('pourQui')?.value === 'SEUL'">
                  <input type="radio" formControlName="pourQui" value="SEUL" class="sr-only" />
                  <span class="form-radio-card__icon">ğŸ§</span>
                  <span class="form-radio-card__label">Solo</span>
                </label>
                <label class="form-radio-card" [class.form-radio-card--active]="form.get('pourQui')?.value === 'ENTRE_AMIS'">
                  <input type="radio" formControlName="pourQui" value="ENTRE_AMIS" class="sr-only" />
                  <span class="form-radio-card__icon">ğŸ‘«</span>
                  <span class="form-radio-card__label">Entre amis</span>
                </label>
                <label class="form-radio-card" [class.form-radio-card--active]="form.get('pourQui')?.value === 'EN_GROUPE'">
                  <input type="radio" formControlName="pourQui" value="EN_GROUPE" class="sr-only" />
                  <span class="form-radio-card__icon">ğŸ‘¥</span>
                  <span class="form-radio-card__label">Groupe</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn--ghost" (click)="cancel()">Annuler</button>
            <button type="submit" class="btn btn--primary form-submit" [disabled]="saving()">
              @if (saving()) { <span class="spinner" aria-hidden="true"></span> }
              {{ isEdit() ? 'Enregistrer les modifications' : 'CrÃ©er le guide' }}
            </button>
          </div>

        </form>
      </div>

      <!-- RIGHT: Live preview -->
      <div class="preview-panel">
        <p class="preview-panel__label">AperÃ§u de la carte</p>
        <div class="preview-card" [style.background-image]="'url(' + coverPreview() + ')'">
          <div class="preview-card__overlay"></div>
          <div class="preview-card__content">
            <div class="preview-card__chips">
              <span class="preview-chip">{{ form.get('saison')?.value }}</span>
              <span class="preview-chip">{{ form.get('mobilite')?.value }}</span>
            </div>
            <h3 class="preview-card__title">
              {{ form.get('titre')?.value || 'Titre du voyage' }}
            </h3>
            <p class="preview-card__meta">
              {{ form.get('jours')?.value || 1 }} jour{{ (form.get('jours')?.value ?? 1) > 1 ? 's' : '' }}
            </p>
            <span class="preview-card__cta">Voir le guide â†’</span>
          </div>
        </div>
        <p class="preview-panel__hint">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          La photo est sÃ©lectionnÃ©e automatiquement selon la destination.
        </p>
      </div>

    </div>
  }
</div>
