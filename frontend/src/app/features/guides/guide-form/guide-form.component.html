<div class="form-page">
  <div class="page-header">
    <div style="display:flex;align-items:center;gap:.75rem">
      <button type="button" class="back-link" (click)="cancel()" aria-label="Annuler">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M19 12H5m0 0l7 7m-7-7l7-7"/>
        </svg>
      </button>
      <h1 class="page-header__title">{{ isEdit() ? 'Modifier le guide' : 'Nouveau guide' }}</h1>
    </div>
  </div>

  @if (error()) {
    <div class="alert alert--error" role="alert">{{ error() }}</div>
  }

  @if (loading()) {
    <div class="loading-container">
      <span class="spinner spinner--dark" aria-label="Chargement"></span>
      Chargement…
    </div>
  } @else {
    <div class="card">
      <div class="card__body">
        <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
          <div class="form-row">
            <div class="form-group" style="flex:2">
              <label for="titre" class="form-label">Titre <span aria-hidden="true" class="text-danger">*</span></label>
              <input
                id="titre"
                type="text"
                formControlName="titre"
                class="form-input"
                [class.form-input--error]="form.get('titre')?.invalid && form.get('titre')?.touched"
                placeholder="Ex: Tour de Bretagne"
              />
              @if (form.get('titre')?.invalid && form.get('titre')?.touched) {
                <span class="form-error" role="alert">Titre requis (min. 2 caractères)</span>
              }
            </div>

            <div class="form-group">
              <label for="jours" class="form-label">Nombre de jours <span aria-hidden="true" class="text-danger">*</span></label>
              <input
                id="jours"
                type="number"
                formControlName="jours"
                class="form-input"
                [class.form-input--error]="form.get('jours')?.invalid && form.get('jours')?.touched"
                min="1"
              />
              @if (form.get('jours')?.invalid && form.get('jours')?.touched) {
                <span class="form-error" role="alert">Minimum 1 jour</span>
              }
            </div>
          </div>

          <div class="form-group">
            <label for="description" class="form-label">Description</label>
            <textarea
              id="description"
              formControlName="description"
              class="form-input form-textarea"
              rows="3"
              placeholder="Décrivez l'itinéraire…"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="mobilite" class="form-label">Mobilité <span aria-hidden="true" class="text-danger">*</span></label>
              <select id="mobilite" formControlName="mobilite" class="form-input form-select">
                <option value="A_PIED">À pied</option>
                <option value="VOITURE">Voiture</option>
                <option value="VELO">Vélo</option>
                <option value="MOTO">Moto</option>
              </select>
            </div>

            <div class="form-group">
              <label for="saison" class="form-label">Saison <span aria-hidden="true" class="text-danger">*</span></label>
              <select id="saison" formControlName="saison" class="form-input form-select">
                <option value="ETE">Été</option>
                <option value="PRINTEMPS">Printemps</option>
                <option value="AUTOMNE">Automne</option>
                <option value="HIVER">Hiver</option>
              </select>
            </div>

            <div class="form-group">
              <label for="pourQui" class="form-label">Public <span aria-hidden="true" class="text-danger">*</span></label>
              <select id="pourQui" formControlName="pourQui" class="form-input form-select">
                <option value="FAMILLE">Famille</option>
                <option value="SEUL">Solo</option>
                <option value="EN_GROUPE">En groupe</option>
                <option value="ENTRE_AMIS">Entre amis</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn--ghost" (click)="cancel()">Annuler</button>
            <button type="submit" class="btn btn--primary" [disabled]="saving()">
              @if (saving()) { <span class="spinner" aria-hidden="true"></span> }
              {{ isEdit() ? 'Enregistrer' : 'Créer le guide' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
