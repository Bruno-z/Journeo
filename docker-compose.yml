version: '3.9'  # Version du format docker-compose

services:
  db:
    image: postgres:15  # Utilise l'image officielle PostgreSQL version 15
    container_name: journeo-db  # Nom du container
    environment:  # Variables d'environnement pour configurer la base
      POSTGRES_DB: journeo  # Nom de la base de données
      POSTGRES_USER: ${DB_USER:-postgres}  # Utilisateur DB (ou variable d'environnement DB_USER)
      POSTGRES_PASSWORD: ${DB_PASSWORD:-postgres}  # Mot de passe DB (ou variable d'environnement DB_PASSWORD)
    ports:
      - "5432:5432"  # Expose le port PostgreSQL sur l'hôte
    volumes:
      - pgdata:/var/lib/postgresql/data  # Persistance des données

  backend:
    build: ./backend  # Build l'image Docker depuis le dossier backend
    container_name: journeo-backend
    ports:
      - "8080:8080"  # Expose Tomcat / Spring Boot sur le port 8080
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://db:5432/journeo  # URL de connexion à PostgreSQL
      SPRING_DATASOURCE_USERNAME: ${DB_USER:-postgres}  # Nom d'utilisateur DB pour Spring
      SPRING_DATASOURCE_PASSWORD: ${DB_PASSWORD:-postgres}  # Mot de passe DB pour Spring
      SPRING_JPA_HIBERNATE_DDL_AUTO: update  # Hibernate crée/maj les tables automatiquement
      SPRING_PROFILES_ACTIVE: dev  # Profil Spring actif
    depends_on:
      - db  # Le backend attend que la DB soit prête

  # Pour le moment, on commente le frontend car il n'y a pas encore d'application Angular
  # frontend:
  #   build: ./frontend
  #   container_name: journeo-frontend
  #   ports:
  #     - "4200:4200"
  #   depends_on:
  #     - backend
  #   command: npm start  # Lance Angular

volumes:
  pgdata:  # Volume Docker pour stocker les données PostgreSQL